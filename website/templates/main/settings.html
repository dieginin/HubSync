{% extends "base.html" %}

{% block title %}Settings | HubSync{% endblock %}

{% from "components/inputs.html" import name_input, email_input, password_input, username_input %}
{% from "components/layout.html" import buttons_block, role_badge %}

{% block content %}
<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="text-center mb-4">Settings</h1>

            {% include 'main/partials/profile_card.html' %}
            {% include 'main/partials/password_card.html' %}
            {% include 'main/partials/theme_card.html' %}
            {% include 'main/partials/information_card.html' %}
        </div>
    </div>
</div>

<script>
    // Theme management using themeManager
    document.addEventListener('DOMContentLoaded', function () {
        // Wait for themeManager to be available
        if (!window.themeManager) {
            console.error('ThemeManager not available');
            return;
        }

        // Get current theme from themeManager (single source of truth)
        const currentTheme = window.themeManager.getCurrentTheme();

        // Set the correct radio button as checked
        const currentThemeRadio = document.querySelector(`input[name="theme"][value="${currentTheme}"]`);
        if (currentThemeRadio) {
            currentThemeRadio.checked = true;
        }

        // Handle theme form submission - prevent default and use themeManager
        const themeForm = document.querySelector('form input[name="form_type"][value="theme"]').closest('form');

        if (themeForm) {
            themeForm.addEventListener('submit', function (e) {
                const selectedTheme = document.querySelector('input[name="theme"]:checked').value;

                // Use themeManager to apply theme (single responsibility)
                window.themeManager.setTheme(selectedTheme);
            });
        }
    });
</script>
{% endblock %}